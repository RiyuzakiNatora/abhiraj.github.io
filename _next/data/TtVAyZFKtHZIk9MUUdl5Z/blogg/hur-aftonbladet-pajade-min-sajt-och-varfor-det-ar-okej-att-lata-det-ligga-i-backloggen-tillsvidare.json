{"pageProps":{"post":{"title":"Hur Aftonbladet pajade min sajt och varför det är okej att låta det ligga i backloggen tillsvidare","date":"2021-07-09T00:00:00.000Z","summary":"För ett tag sedan gjorde Aftonbladet ganska stora ändringar på sin startsida som resulterade till att en av mina sajter i princip vart värdelös. Men det är helt okej!","description":"Aftonbladet har börjat med lazy loading på sin startsida. Det här hände då med min sajt/scraper.","body":{"raw":"\n## Sajten\n\nJag har tidigare [skrivit lite](/blogg/att-vacka-liv-i-ett-3-ar-gammalt-projekt) om en sajt/scraper jag byggt - som via en api-endpoint parsa startsidan på Aftonbladet och sparar ned viss data om Aftonbladets startsida i Google Firebase.\n\nEndpointen anropas dagligen klockan 12 och har nu fungerat felfritt i ett antal år, fram till i år.\n\n## Aftonbladet förstör för scrapern\n\n![Data insamlat från start](/img/posts/scraper-1.jpg)\n\nBilden ovan illustrerar data för varje dag som scrapern har skannat av Aftonbladets startsida från första dagen till skrivande stund (juli 2021).\n\n> Något som är helt orelaterat men ändå intressant är om man tittar från 2017-2019. Aftonbladet drog ned användandet av ✔ i sina artikelpuffar rätt så mycket under den här perioden. Sedan pandemin drog igång 2020 så gick användandet upp igen däremot. Men nu var det inte det vi skulle fokusera på.\n\nI början på 2021 så ser man något avvikande. Helt plötsligt fångar scrapern inte alls lika mycket data. Beror det på att användandet av ✔ har minskat?\n\nNär jag upptäckte det här (lite i efterhand) så besökte jag Aftonbladet för att se vad som kan ha hänt. Har dom ändrat HTML-strukturen för att fånga alla ✔?\n\nJag skrollade runt på sajten och upptäckte att Aftonbladet laddar inte in hela startsidan på en gång längre utan dom har implementerat **Infinite scroll** - innehåll laddar allt eftersom man skrollar.\n\nInte så konstigt att min scraper misslyckas med att samla in alla data korrekt alltså.\n\nKikar man på den här bilden så verkar det dessutom som att Aftonbladet lanserade denna feature 20/01/2021:\n![Närbild på data](/img/posts/scraper-2.jpg)\n\nDen dagen fångades bara 12 stycken checkar och sedan dess har mycket förre checkar sparats ned i Google Firebase.\n\n## Ännu färre datapunkter efter ett tag\n\nJaha. Min scraper fångar inte längre alla checkar som används på startsidan. När jag upptäckte det här problemet gjorde jag dock inget åt det på en gång.\n\nJag höll däremot lite koll under 2021 och kunde efter ett tag se det här fenomenet:\n![Närbild på data](/img/posts/scraper-3.jpg)\n\nHelt plötsligt fångades **ingen data** alls. Vad har Aftonbladet nu hittat på? När jag upptäckte detta gick jag till deras startsida och kunde se att checkar ritades ju faktiskt ut.\n\nJag inspekterade HTML-koden och kunde se att checkarna däremot ritades ut på ett nytt sätt. Min scraper kunde inte urskilja dem då scrapern letade efter en css-klass som inte längre användes för att rita ut checkarna.\n\n## Att fixa eller inte fixa\n\nNu var alltså min scraper helt trasig egentligen och skulle behöva uppdateras:\n\n- Se till att hela startsidan läses in i scrapern för att fånga alla checkar.\n- Uppdatera scrapern för att identifiera checkarna på nytt.\n- _(Nice to have) någon slags monitorering för att snabbare fånga om scrapern fångar ett avvikande antal datapunkter._\n\nÄr det här något jag har fixat? Nope… Det här är ju bara ett litet sidoprojekt, som dessutom inte kostar mig något i drift eller så. Det känns inte heller värt att släcka ned sajten då den ändå har historisk data från 2017 som ändå är lite intressant.\n\n> Lusten att pyssla med såna här programmeringssprojekt vid sidan av jobbet kommer och går i perioder.\n\nDe här problemen har uppstått under en period då lusten för hobbyprogrammering är relativt låg. Då tycker jag ändå det är viktigt att inte tvinga sig själv att fortsätta sitta framför datorn och knacka kod när arbetsdagen är slut. Då är det bättre att göra något annat, så kanske suget är tillbaka efter ett tag.\n","code":"var Component=(()=>{var p=Object.create;var i=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,f=Object.prototype.hasOwnProperty;var k=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),u=(e,t)=>{for(var n in t)i(e,n,{get:t[n],enumerable:!0})},d=(e,t,n,s)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let r of h(t))!f.call(e,r)&&r!==n&&i(e,r,{get:()=>t[r],enumerable:!(s=g(t,r))||s.enumerable});return e};var b=(e,t,n)=>(n=e!=null?p(m(e)):{},d(t||!e||!e.__esModule?i(n,\"default\",{value:e,enumerable:!0}):n,e)),j=e=>d(i({},\"__esModule\",{value:!0}),e);var o=k((D,l)=>{l.exports=_jsx_runtime});var A={};u(A,{default:()=>y,frontmatter:()=>v});var a=b(o()),v={title:\"Hur Aftonbladet pajade min sajt och varf\\xF6r det \\xE4r okej att l\\xE5ta det ligga i backloggen tillsvidare\",summary:\"F\\xF6r ett tag sedan gjorde Aftonbladet ganska stora \\xE4ndringar p\\xE5 sin startsida som resulterade till att en av mina sajter i princip vart v\\xE4rdel\\xF6s. Men det \\xE4r helt okej!\",description:\"Aftonbladet har b\\xF6rjat med lazy loading p\\xE5 sin startsida. Det h\\xE4r h\\xE4nde d\\xE5 med min sajt/scraper.\",date:new Date(16257888e5)};function c(e){let t=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",img:\"img\",blockquote:\"blockquote\",strong:\"strong\",ul:\"ul\",li:\"li\",em:\"em\"},e.components);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(t.h2,{id:\"sajten\",children:[(0,a.jsx)(t.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#sajten\",children:(0,a.jsx)(t.span,{className:\"icon icon-link\"})}),\"Sajten\"]}),`\n`,(0,a.jsxs)(t.p,{children:[\"Jag har tidigare \",(0,a.jsx)(t.a,{href:\"/blogg/att-vacka-liv-i-ett-3-ar-gammalt-projekt\",children:\"skrivit lite\"}),\" om en sajt/scraper jag byggt - som via en api-endpoint parsa startsidan p\\xE5 Aftonbladet och sparar ned viss data om Aftonbladets startsida i Google Firebase.\"]}),`\n`,(0,a.jsx)(t.p,{children:\"Endpointen anropas dagligen klockan 12 och har nu fungerat felfritt i ett antal \\xE5r, fram till i \\xE5r.\"}),`\n`,(0,a.jsxs)(t.h2,{id:\"aftonbladet-f\\xF6rst\\xF6r-f\\xF6r-scrapern\",children:[(0,a.jsx)(t.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#aftonbladet-f\\xF6rst\\xF6r-f\\xF6r-scrapern\",children:(0,a.jsx)(t.span,{className:\"icon icon-link\"})}),\"Aftonbladet f\\xF6rst\\xF6r f\\xF6r scrapern\"]}),`\n`,(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:\"/img/posts/scraper-1.jpg\",alt:\"Data insamlat fr\\xE5n start\"})}),`\n`,(0,a.jsx)(t.p,{children:\"Bilden ovan illustrerar data f\\xF6r varje dag som scrapern har skannat av Aftonbladets startsida fr\\xE5n f\\xF6rsta dagen till skrivande stund (juli 2021).\"}),`\n`,(0,a.jsxs)(t.blockquote,{children:[`\n`,(0,a.jsx)(t.p,{children:\"N\\xE5got som \\xE4r helt orelaterat men \\xE4nd\\xE5 intressant \\xE4r om man tittar fr\\xE5n 2017-2019. Aftonbladet drog ned anv\\xE4ndandet av \\u2714 i sina artikelpuffar r\\xE4tt s\\xE5 mycket under den h\\xE4r perioden. Sedan pandemin drog ig\\xE5ng 2020 s\\xE5 gick anv\\xE4ndandet upp igen d\\xE4remot. Men nu var det inte det vi skulle fokusera p\\xE5.\"}),`\n`]}),`\n`,(0,a.jsx)(t.p,{children:\"I b\\xF6rjan p\\xE5 2021 s\\xE5 ser man n\\xE5got avvikande. Helt pl\\xF6tsligt f\\xE5ngar scrapern inte alls lika mycket data. Beror det p\\xE5 att anv\\xE4ndandet av \\u2714 har minskat?\"}),`\n`,(0,a.jsx)(t.p,{children:\"N\\xE4r jag uppt\\xE4ckte det h\\xE4r (lite i efterhand) s\\xE5 bes\\xF6kte jag Aftonbladet f\\xF6r att se vad som kan ha h\\xE4nt. Har dom \\xE4ndrat HTML-strukturen f\\xF6r att f\\xE5nga alla \\u2714?\"}),`\n`,(0,a.jsxs)(t.p,{children:[\"Jag skrollade runt p\\xE5 sajten och uppt\\xE4ckte att Aftonbladet laddar inte in hela startsidan p\\xE5 en g\\xE5ng l\\xE4ngre utan dom har implementerat \",(0,a.jsx)(t.strong,{children:\"Infinite scroll\"}),\" - inneh\\xE5ll laddar allt eftersom man skrollar.\"]}),`\n`,(0,a.jsx)(t.p,{children:\"Inte s\\xE5 konstigt att min scraper misslyckas med att samla in alla data korrekt allts\\xE5.\"}),`\n`,(0,a.jsxs)(t.p,{children:[`Kikar man p\\xE5 den h\\xE4r bilden s\\xE5 verkar det dessutom som att Aftonbladet lanserade denna feature 20/01/2021:\n`,(0,a.jsx)(t.img,{src:\"/img/posts/scraper-2.jpg\",alt:\"N\\xE4rbild p\\xE5 data\"})]}),`\n`,(0,a.jsx)(t.p,{children:\"Den dagen f\\xE5ngades bara 12 stycken checkar och sedan dess har mycket f\\xF6rre checkar sparats ned i Google Firebase.\"}),`\n`,(0,a.jsxs)(t.h2,{id:\"\\xE4nnu-f\\xE4rre-datapunkter-efter-ett-tag\",children:[(0,a.jsx)(t.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#\\xE4nnu-f\\xE4rre-datapunkter-efter-ett-tag\",children:(0,a.jsx)(t.span,{className:\"icon icon-link\"})}),\"\\xC4nnu f\\xE4rre datapunkter efter ett tag\"]}),`\n`,(0,a.jsx)(t.p,{children:\"Jaha. Min scraper f\\xE5ngar inte l\\xE4ngre alla checkar som anv\\xE4nds p\\xE5 startsidan. N\\xE4r jag uppt\\xE4ckte det h\\xE4r problemet gjorde jag dock inget \\xE5t det p\\xE5 en g\\xE5ng.\"}),`\n`,(0,a.jsxs)(t.p,{children:[`Jag h\\xF6ll d\\xE4remot lite koll under 2021 och kunde efter ett tag se det h\\xE4r fenomenet:\n`,(0,a.jsx)(t.img,{src:\"/img/posts/scraper-3.jpg\",alt:\"N\\xE4rbild p\\xE5 data\"})]}),`\n`,(0,a.jsxs)(t.p,{children:[\"Helt pl\\xF6tsligt f\\xE5ngades \",(0,a.jsx)(t.strong,{children:\"ingen data\"}),\" alls. Vad har Aftonbladet nu hittat p\\xE5? N\\xE4r jag uppt\\xE4ckte detta gick jag till deras startsida och kunde se att checkar ritades ju faktiskt ut.\"]}),`\n`,(0,a.jsx)(t.p,{children:\"Jag inspekterade HTML-koden och kunde se att checkarna d\\xE4remot ritades ut p\\xE5 ett nytt s\\xE4tt. Min scraper kunde inte urskilja dem d\\xE5 scrapern letade efter en css-klass som inte l\\xE4ngre anv\\xE4ndes f\\xF6r att rita ut checkarna.\"}),`\n`,(0,a.jsxs)(t.h2,{id:\"att-fixa-eller-inte-fixa\",children:[(0,a.jsx)(t.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#att-fixa-eller-inte-fixa\",children:(0,a.jsx)(t.span,{className:\"icon icon-link\"})}),\"Att fixa eller inte fixa\"]}),`\n`,(0,a.jsx)(t.p,{children:\"Nu var allts\\xE5 min scraper helt trasig egentligen och skulle beh\\xF6va uppdateras:\"}),`\n`,(0,a.jsxs)(t.ul,{children:[`\n`,(0,a.jsx)(t.li,{children:\"Se till att hela startsidan l\\xE4ses in i scrapern f\\xF6r att f\\xE5nga alla checkar.\"}),`\n`,(0,a.jsx)(t.li,{children:\"Uppdatera scrapern f\\xF6r att identifiera checkarna p\\xE5 nytt.\"}),`\n`,(0,a.jsx)(t.li,{children:(0,a.jsx)(t.em,{children:\"(Nice to have) n\\xE5gon slags monitorering f\\xF6r att snabbare f\\xE5nga om scrapern f\\xE5ngar ett avvikande antal datapunkter.\"})}),`\n`]}),`\n`,(0,a.jsx)(t.p,{children:\"\\xC4r det h\\xE4r n\\xE5got jag har fixat? Nope\\u2026 Det h\\xE4r \\xE4r ju bara ett litet sidoprojekt, som dessutom inte kostar mig n\\xE5got i drift eller s\\xE5. Det k\\xE4nns inte heller v\\xE4rt att sl\\xE4cka ned sajten d\\xE5 den \\xE4nd\\xE5 har historisk data fr\\xE5n 2017 som \\xE4nd\\xE5 \\xE4r lite intressant.\"}),`\n`,(0,a.jsxs)(t.blockquote,{children:[`\n`,(0,a.jsx)(t.p,{children:\"Lusten att pyssla med s\\xE5na h\\xE4r programmeringssprojekt vid sidan av jobbet kommer och g\\xE5r i perioder.\"}),`\n`]}),`\n`,(0,a.jsx)(t.p,{children:\"De h\\xE4r problemen har uppst\\xE5tt under en period d\\xE5 lusten f\\xF6r hobbyprogrammering \\xE4r relativt l\\xE5g. D\\xE5 tycker jag \\xE4nd\\xE5 det \\xE4r viktigt att inte tvinga sig sj\\xE4lv att forts\\xE4tta sitta framf\\xF6r datorn och knacka kod n\\xE4r arbetsdagen \\xE4r slut. D\\xE5 \\xE4r det b\\xE4ttre att g\\xF6ra n\\xE5got annat, s\\xE5 kanske suget \\xE4r tillbaka efter ett tag.\"})]})}function x(e={}){let{wrapper:t}=e.components||{};return t?(0,a.jsx)(t,Object.assign({},e,{children:(0,a.jsx)(c,e)})):c(e)}var y=x;return j(A);})();\n;return Component;"},"_id":"posts/hur-aftonbladet-pajade-min-sajt-och-varfor-det-ar-okej-att-lata-det-ligga-i-backloggen-tillsvidare.mdx","_raw":{"sourceFilePath":"posts/hur-aftonbladet-pajade-min-sajt-och-varfor-det-ar-okej-att-lata-det-ligga-i-backloggen-tillsvidare.mdx","sourceFileName":"hur-aftonbladet-pajade-min-sajt-och-varfor-det-ar-okej-att-lata-det-ligga-i-backloggen-tillsvidare.mdx","sourceFileDir":"posts","contentType":"mdx","flattenedPath":"posts/hur-aftonbladet-pajade-min-sajt-och-varfor-det-ar-okej-att-lata-det-ligga-i-backloggen-tillsvidare"},"type":"Post","url":"/blogg/hur-aftonbladet-pajade-min-sajt-och-varfor-det-ar-okej-att-lata-det-ligga-i-backloggen-tillsvidare","dateFormatted":"2021-07-09"},"prevPost":{"title":"När man förmodligen vill byta ut useState mot useReducer","date":"2021-02-13T00:00:00.000Z","summary":"Hook:en useState är bra till mycket. Men ibland räcker inte den inte hela vägen. Det här är lite reflektioner över första gången jag använde useReducer för att lösa lite mer avancerad state.","body":{"raw":"\nDet här är en genomgång och reflektioner av hur det gick till när jag för första gången använde useReducer som ett rimligare alternativ till useState, på grund av ett multi-steg-formulärs komplexitet.\n\n## Kort om useState\n\nReact-hook:en `useState` är väldigt smidig att använda när man vill göra en funktionskomponent stateful. Det är relativt lätt att hämta lite data asynkront från ett API och sätta det i state, eller koppla ihop inputfältvärden med state.\n\nEn uppenbar skillnad mellan useState och hur man ofta skriver och sätter state i klasskomponenter är att man via useState kan ha flera ”state-variabler”, medan man i en klass-komponent jobbar med state som ett objekt.\n\nSäg att man har ett formulär och vill använda useState för state-hantering med 3-4 inputfält. Det enklaste är nog att ha separata state-variabler för varje inputfält, ungefär så här:\n\n```ts showLineNumbers\nconst [inputOne, setInputOne] = useState(’’);\nconst [inputTwo, setInputTwo] = useState(’’);\nconst [inputThree, setInputThree] = useState(’’);\nconst [inputFour, setInputFour] = useState(’’);\n```\n\nAtt separera state för ett formulär på det här sättet kanske är det mest uppenbara tillvägagångssättet. Ett alternativ för när ett formulär, eller vilken sorts komponent som helst egentligen som behöver state, inte är speciellt komplext och när det inte finns så många ”nyanser” i hur state:t kan se ut.\n\nNär man då istället behöver lite komplexare state-hantering kan det kanske ses naturligt att gruppera state i ett objekt istället, likt state för en klass-komponent. Detta kan framför allt vara bra för att man får en bättre överblick över hur en komponents state ser ut, istället för att man har väldigt många individuella `const [state, setState] = useState()` att hålla reda på.\n\nÖverskådligheten blir om ännu bättre om man använder TypeScript och kan typa upp sitt useState objekt.\n\n### När useState inte räcker till\n\nRäcker det då att fortsätta använda useState tillsammans med ett objekt istället och låta formuläret/funktionskomponent sköta lite komplexare state-logik? Inte riktigt. Den officiella dokumentationen för React [rekommenderar](https://reactjs.org/docs/hooks-reference.html) att man istället ska använda hook:en `useReducer`, med motiveringen:\n\n> **useReducer** is usually preferable to **useState** when you have complex state logic that involves multiple sub-values or when the next state depends on the previous one\n\nFlera individuella useState-variabler, ett enda state-objekt och sen useReducer. Det är i stora drag de tre olika stadier som jag och en kollega gick igenom när vi för ett tag sedan i ett projekt skulle bygga ett multi-stegs formulär. Ett formulär som involverade datahämtning via ett API och där de olika formulär-stegen hade beroenden av state mellan sig.\n\n## Fas 1: useState-variabler everywhere!\n\nJag och en kollega skulle som sagt bygga ett formulär som hade flera olika steg. Kortfattad och simplifierat skulle formuläret bete sig så här:\n\n- **I steg 1:** Inputfält för att söka efter data via ett API och låt användaren välja ett alternativ från API:et. Beroende på vad användaren väljer går ett till API-anrop iväg och beroende på om man får en eller fler träffar tillbaka låt användaren välja ett av de alternativen. Får man bara en träff från det andra API-anropet ska den infon sättas direkt i state istället för att användaren behöver välja något.\n- **I steg 2**: Beroende på state som sätts i steg 1 så hämtas annan data från ett API och användaren får välja några alternativ i dropdown-inputs.\n- **I steg 3**: Användaren granskar den data som hen angett i steg 1 och 2.\n\nAnvändaren har även möjlighet att backa ett steg i taget i formuläret och eftersom att steg 2 beror på data som valts i steg 1 så skulle all state rensas i steg 1.\n\nNär vi började bygga formuläret hade vi inte riktigt rett ut exakt alla stadier och nyanser i state:et för formuläret.\n\nVi började helt enkelt med en `const [inputOne, setInputTwo] = useState(’’)` för varje liten del av formulär-state:t vi kom på och byggde successivt upp mer och mer state-variabler och kopplade ihop dessa med `onChange()` callbacks på input-fält och satte data från API-anrop till state-variablerna.\n\nI takt med att vi utforskade all state-logik och komplexitet som faktiskt fanns i det formulär vi höll på att bygga insåg vi att det vart rätt ohållbart att hålla reda på all state-logik. Detta för att små bitar av formulär-state sattes här och där i callbacks och asynkront efter API-anrop.\n\nVi började även få state-variabler som berodde på andra state-variabler och hade svårt att se helheten för formuläret, all dess logik och nyanser av state.\n\n## Fas 2: Gruppera state i ett objekt\n\nI ett försök att ta lite mer kontroll över formulärets state och få bättre överblick så flyttade vi in alla individuella bitar av state till ett enda objekt istället.\n\nAtt gruppera allt i ett objekt hjälpte till avsevärt med överblicken av formulär-datat. Mycket för att vi skrev TypeScript-kod och typade upp ett interface för hela formulärets state.\n\nVi slapp även flera individuella `setState()` anrop för flera sub-värden i state:t. Vi gick från sånt här:\n\n```js showLineNumbers\nconst onInputChange = async (value) => {\n  setInputOne(value);\n  const data = await fetchFromAPI(value);\n  setDataOne(data);\n};\n```\n\nTill att istället skriva sånt här:\n\n```js showLineNumbers\nconst onInputChange = async (value) => {\n  const data = await fetchFromAPI(value);\n  setState({ ...state, inputOne: value, dataOne: data });\n};\n```\n\nPerfekt. Vi hade nu alltså bättre koll på hur formulärets state såg ut för att allt var grupperat.\n\nNågot vi fortfarande hade problem med var att vi i **formulär-komponenten behövde ha stenkoll på beroenden mellan sub-värden i state-objektet**.\n\nEtt konkret exempel på detta är att vi allt eftersom upptäckte att vi behövde lite custom input-valideringsfeedback i formulärets olika steg innan man kunde gå vidare till nästa steg. Sån feedback ritades ut i alerts direkt i formuläret och feedback-texterna sattes i state-objektet som en array med strängar.\n\nOm användaren då försökte gå vidare till nästa steg i formuläret fick denne feedback om att viss input-data saknades. När användaren då började fylla i den datan skulle feedbacken försvinna. Vi började få sådana här exempel lite här och var i koden:\n\n```js showLineNumbers\nconst onInputChange = (value) => {\n  setState({ ...state, inputOne: value, feedback: [] });\n};\n```\n\nEtt annat exempel på beroenden mellan sub-värden är att det kunde uppstå scenarion då användaren inte ens skulle kunna gå vidare från steg 1 till steg 2, beroende på den data man fick tillbaka från API:et i steg 1. Detta styrde vi med boolean-flaggor i state-objektet som sattes till true eller false beroende på svarsdatat från API:et.\n\nEtt tredje exempel är att all state skulle rensas när användarn gick tillbaka till steg 1 i formuläret. Vi hade en generell funktion som tog in ett givet steg som en parameter och satte den parametern i state-objektet. När inparametern dock var `0`, vilket representerade steg 1, så skulle hela state:t tömmas.\n\nKomplexiteten och alla nyanser i state:t behövde dels vi som utvecklare av formuläret, men även formuläret i sig ha stenkoll på. I en del lägen skulle man sätta men också rensa sub-värden i state:t och i andra lägen skulle man tolka data som skulle sättas i två sub-state värden på två olika sätt.\n\n**Det är i det här läget som vi började snegla på att använda useReducer istället.**\n\n## Fas 3: Kasta ut useState och välkomna useReducer\n\nDen korta beskrivningen en bit upp i denna text som beskriver de lägen som useReducer är att rekommendera över useState angående komplex state-logik och sub-värden är väldigt talande för de fördelar vi snabbt såg efter att vi hade refaktorerat formulärets state till en useReducer istället.\n\nAtt vi började snegla mot useReducer började väl med att vi i princip hade all state-logik på plats och formuläret i sin helhet fungerade enligt kravspec, med vårat state-objekt.\n\nMen när vi kikade igenom koden kändes det fortfarande som att det var väldigt många olika callbacks osv där state sattes och vi hade fortfarande kvar alla beroenden mellan sub-värden.\n\nFormulär-komponenten var helt enkelt svår att hänga med i då det sattes state lite här och där och vi behövde ha stenkoll på i vilka callbacks som validerings-feedback skulle rensas osv.\n\nFormuläret i sig behövde även ha koll på att när användaren klickar sig bakåt mellan stegen så ska hela state-objektet rensas om användaren klickade sig tillbaka till första steget.\n\n### Vad gör useReducer?\n\nVad är det då som skiljer useState från useReducer? useReducer fungerar lite mer som Redux i det sätt att useReducer-hooken ger tillbaka `state` och en `dispatch` funktion. Via dispatch skickar man olika ”actions” med eller utan data för att uppdatera state, via en reducer-funktion:\n\n```js\nconst [state, dispatch] = useReducer(reducer, initialState);\n```\n\nReducer-funktionen i sin tur tar state:ta nuvarande version och en action som parametrar och vanligtvis (precis som med Redux) så brukar reducern bestå av en switch/case på `action.type` där olika action-types uppdaterar state på lite olika sätt.\n\n> Vill man veta mer om useReducer så är den [officiella dokumentationen](https://reactjs.org/docs/hooks-reference.html) en bra startpunkt.\n\nFör den komponent som ska uppdatera state handlar det förenklat om att man går från `setState({ ...state, inputOne: value})` till `dispatch({ type: ’INPUT_ONE’, value })`.\n\n### Vilka fördelar såg vi?\n\nVilka fördelar kunde vi då se när vi refaktorerade från lösningen med useState och vårat state-objekt till att använda useReducer istället?\n\nDen allra största fördelen vi såg var att formulär-komponenten nu bara behövde fokusera på **vad** som skulle hända och inte exakt **hur** något skulle hända. Om man ska ta exemplet med att låta användaren backa i formuläret så gick vi från (ungefär):\n\n```js showLineNumbers\nconst onStepChange = (step) => {\n  if (step === 0) {\n    setState(emptyFormData);\n    return;\n  }\n  setState({ ...state, step: step });\n};\n```\n\nTill en lösning där formuläret inte behövde bry sig om sådana detaljer:\n\n```js showLineNumbers\nconst onStepChange = (step) => {\n\tdispatch({ type: ’FORM_STEP’, step: step });\n}\n```\n\nVår formulär-reducer såg då till att själv antingen bara backa ett steg eller rensa hela formuläret i sin helhet, då användaren backade till första steget.\n\nEn annan fördel vi såg var att formuläret inte längre behövde bry sig om att i vissa lägen rensa den validerings-feedback array som fanns i state. Sådana detaljer var upp till reducern att sköta, beroende på vilken action som formuläret dispatchade.\n\nEn tredje fördel var att formuläret nu inte längre behövde bry sig alls om eventuella beroenden mellan sub-värden i state:t. Formuläret dispatchade bara sina actions med tillhörande data och reducern såg till att sätta eventuella boolean-flaggor osv själv.\n\n### Mer boilerplate-kod men kontrollerade state-förändringar\n\nVisserligen innebar useReducern lite mer ”boilerplate-kod”, framför allt då vi jobbar med TypeScript och typade upp alla action-typen och payloads som man kunde skicka in i reducern. Men detta innebar ju också att vi fick ett tydligare kontrakt mellan formuläret och reducern, och hur formuläret kunde påverka state:t på ett väligt kontrollerat sätt.\n\nAll boilerplate gjorde det tydligt att vi kunde lyfta ut useReducern till en custom hook. Då vi gjorde detta blev dessutom formulär-komponenten 100% mer överskådlig. Nu ansvarade formulär-komponenten i princip bara för att hämta data från API:er i vissa funktioner och dispatcha actions, samt dispatcha vissa actions direkt i ”onInputChange-funktioner”.\n\nAll faktiskt state-hantering lyftes ut till en separat fil. Behövde vi se hur state:t såg ut eller hur det skulle förändras över tid gav reducern oss en tydligare överblick, istället för att behöva skrolla runt i formulär-komponenten och jaga `setState` anrop.\n\n## Summering\n\nPhew! Där var vi i mål!\n\nVad kan man då dra för summerande slutsatser av det hela? Ska man strunta i useState helt och istället använda useReducer? Absolut inte! Hook:en useState är väldigt bra om man har ett state som inte är speciellt komplext. Att alltid använda useReducer skulle förmodligen innebära onödigt komplex lösning för en icke-komplex utmaning.\n\nMen å andra sidan tror jag inte man ska vara rädd för att byta ut useState mot useReducer i de lägen en komponents state växer. Personligen tyckte jag att useReducer såg ut som onödigt avancerat sätt att hantera state i funktions-komponenter innan jag testade på den, men såg genast fördelar med den när jag väl började använda den.\n\nHar man lite mer avancerat state och synkar inte bara input-fält till data eller tänder och släcker grejer rent visuellt med boolean-flaggor är useReducer ett väldigt bra alternativ för att få bättre kontroll över state och state-förändringar.\n\n> Värt att påpeka är ju att det här är tankar och funderingar efter att ha använt useReducer _en_ gång. Men jag kände ändå för att få nedskrivet några reflektioner.\n\nNästa gång jag står inför lite mer avancerad state kommer jag i alla fall inte tveka att överväga useReducer som lösning istället för useState, då man har mycket att vinna på det!\n","code":"var Component=(()=>{var p=Object.create;var r=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var g=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports),v=(a,e)=>{for(var t in e)r(a,t,{get:e[t],enumerable:!0})},i=(a,e,t,l)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let s of h(e))!k.call(a,s)&&s!==t&&r(a,s,{get:()=>e[s],enumerable:!(l=u(e,s))||l.enumerable});return a};var f=(a,e,t)=>(t=a!=null?p(m(a)):{},i(e||!a||!a.__esModule?r(t,\"default\",{value:a,enumerable:!0}):t,a)),N=a=>i(r({},\"__esModule\",{value:!0}),a);var o=g((x,c)=>{c.exports=_jsx_runtime});var S={};v(S,{default:()=>j,frontmatter:()=>b});var n=f(o()),b={title:\"N\\xE4r man f\\xF6rmodligen vill byta ut useState mot useReducer\",summary:\"Hook:en useState \\xE4r bra till mycket. Men ibland r\\xE4cker inte den inte hela v\\xE4gen. Det h\\xE4r \\xE4r lite reflektioner \\xF6ver f\\xF6rsta g\\xE5ngen jag anv\\xE4nde useReducer f\\xF6r att l\\xF6sa lite mer avancerad state.\",date:new Date(16131744e5)};function d(a){let e=Object.assign({p:\"p\",h2:\"h2\",a:\"a\",span:\"span\",code:\"code\",pre:\"pre\",h3:\"h3\",blockquote:\"blockquote\",strong:\"strong\",ul:\"ul\",li:\"li\",em:\"em\"},a.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:\"Det h\\xE4r \\xE4r en genomg\\xE5ng och reflektioner av hur det gick till n\\xE4r jag f\\xF6r f\\xF6rsta g\\xE5ngen anv\\xE4nde useReducer som ett rimligare alternativ till useState, p\\xE5 grund av ett multi-steg-formul\\xE4rs komplexitet.\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"kort-om-usestate\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#kort-om-usestate\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Kort om useState\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"React-hook:en \",(0,n.jsx)(e.code,{children:\"useState\"}),\" \\xE4r v\\xE4ldigt smidig att anv\\xE4nda n\\xE4r man vill g\\xF6ra en funktionskomponent stateful. Det \\xE4r relativt l\\xE4tt att h\\xE4mta lite data asynkront fr\\xE5n ett API och s\\xE4tta det i state, eller koppla ihop inputf\\xE4ltv\\xE4rden med state.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"En uppenbar skillnad mellan useState och hur man ofta skriver och s\\xE4tter state i klasskomponenter \\xE4r att man via useState kan ha flera \\u201Dstate-variabler\\u201D, medan man i en klass-komponent jobbar med state som ett objekt.\"}),`\n`,(0,n.jsx)(e.p,{children:\"S\\xE4g att man har ett formul\\xE4r och vill anv\\xE4nda useState f\\xF6r state-hantering med 3-4 inputf\\xE4lt. Det enklaste \\xE4r nog att ha separata state-variabler f\\xF6r varje inputf\\xE4lt, ungef\\xE4r s\\xE5 h\\xE4r:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"language-ts code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"1\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"inputOne\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" setInputOne\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"useState\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"\\u2019\\u2019\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"2\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"inputTwo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" setInputTwo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"useState\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"\\u2019\\u2019\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"3\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"inputThree\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" setInputThree\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"useState\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"\\u2019\\u2019\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"4\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"inputFour\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" setInputFour\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"useState\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"\\u2019\\u2019\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Att separera state f\\xF6r ett formul\\xE4r p\\xE5 det h\\xE4r s\\xE4ttet kanske \\xE4r det mest uppenbara tillv\\xE4gag\\xE5ngss\\xE4ttet. Ett alternativ f\\xF6r n\\xE4r ett formul\\xE4r, eller vilken sorts komponent som helst egentligen som beh\\xF6ver state, inte \\xE4r speciellt komplext och n\\xE4r det inte finns s\\xE5 m\\xE5nga \\u201Dnyanser\\u201D i hur state:t kan se ut.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"N\\xE4r man d\\xE5 ist\\xE4llet beh\\xF6ver lite komplexare state-hantering kan det kanske ses naturligt att gruppera state i ett objekt ist\\xE4llet, likt state f\\xF6r en klass-komponent. Detta kan framf\\xF6r allt vara bra f\\xF6r att man f\\xE5r en b\\xE4ttre \\xF6verblick \\xF6ver hur en komponents state ser ut, ist\\xE4llet f\\xF6r att man har v\\xE4ldigt m\\xE5nga individuella \",(0,n.jsx)(e.code,{children:\"const [state, setState] = useState()\"}),\" att h\\xE5lla reda p\\xE5.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"\\xD6versk\\xE5dligheten blir om \\xE4nnu b\\xE4ttre om man anv\\xE4nder TypeScript och kan typa upp sitt useState objekt.\"}),`\n`,(0,n.jsxs)(e.h3,{id:\"n\\xE4r-usestate-inte-r\\xE4cker-till\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#n\\xE4r-usestate-inte-r\\xE4cker-till\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"N\\xE4r useState inte r\\xE4cker till\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"R\\xE4cker det d\\xE5 att forts\\xE4tta anv\\xE4nda useState tillsammans med ett objekt ist\\xE4llet och l\\xE5ta formul\\xE4ret/funktionskomponent sk\\xF6ta lite komplexare state-logik? Inte riktigt. Den officiella dokumentationen f\\xF6r React \",(0,n.jsx)(e.a,{href:\"https://reactjs.org/docs/hooks-reference.html\",children:\"rekommenderar\"}),\" att man ist\\xE4llet ska anv\\xE4nda hook:en \",(0,n.jsx)(e.code,{children:\"useReducer\"}),\", med motiveringen:\"]}),`\n`,(0,n.jsxs)(e.blockquote,{children:[`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"useReducer\"}),\" is usually preferable to \",(0,n.jsx)(e.strong,{children:\"useState\"}),\" when you have complex state logic that involves multiple sub-values or when the next state depends on the previous one\"]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Flera individuella useState-variabler, ett enda state-objekt och sen useReducer. Det \\xE4r i stora drag de tre olika stadier som jag och en kollega gick igenom n\\xE4r vi f\\xF6r ett tag sedan i ett projekt skulle bygga ett multi-stegs formul\\xE4r. Ett formul\\xE4r som involverade datah\\xE4mtning via ett API och d\\xE4r de olika formul\\xE4r-stegen hade beroenden av state mellan sig.\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"fas-1-usestate-variabler-everywhere\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#fas-1-usestate-variabler-everywhere\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Fas 1: useState-variabler everywhere!\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Jag och en kollega skulle som sagt bygga ett formul\\xE4r som hade flera olika steg. Kortfattad och simplifierat skulle formul\\xE4ret bete sig s\\xE5 h\\xE4r:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"I steg 1:\"}),\" Inputf\\xE4lt f\\xF6r att s\\xF6ka efter data via ett API och l\\xE5t anv\\xE4ndaren v\\xE4lja ett alternativ fr\\xE5n API:et. Beroende p\\xE5 vad anv\\xE4ndaren v\\xE4ljer g\\xE5r ett till API-anrop iv\\xE4g och beroende p\\xE5 om man f\\xE5r en eller fler tr\\xE4ffar tillbaka l\\xE5t anv\\xE4ndaren v\\xE4lja ett av de alternativen. F\\xE5r man bara en tr\\xE4ff fr\\xE5n det andra API-anropet ska den infon s\\xE4ttas direkt i state ist\\xE4llet f\\xF6r att anv\\xE4ndaren beh\\xF6ver v\\xE4lja n\\xE5got.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"I steg 2\"}),\": Beroende p\\xE5 state som s\\xE4tts i steg 1 s\\xE5 h\\xE4mtas annan data fr\\xE5n ett API och anv\\xE4ndaren f\\xE5r v\\xE4lja n\\xE5gra alternativ i dropdown-inputs.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"I steg 3\"}),\": Anv\\xE4ndaren granskar den data som hen angett i steg 1 och 2.\"]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Anv\\xE4ndaren har \\xE4ven m\\xF6jlighet att backa ett steg i taget i formul\\xE4ret och eftersom att steg 2 beror p\\xE5 data som valts i steg 1 s\\xE5 skulle all state rensas i steg 1.\"}),`\n`,(0,n.jsx)(e.p,{children:\"N\\xE4r vi b\\xF6rjade bygga formul\\xE4ret hade vi inte riktigt rett ut exakt alla stadier och nyanser i state:et f\\xF6r formul\\xE4ret.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Vi b\\xF6rjade helt enkelt med en \",(0,n.jsx)(e.code,{children:\"const [inputOne, setInputTwo] = useState(\\u2019\\u2019)\"}),\" f\\xF6r varje liten del av formul\\xE4r-state:t vi kom p\\xE5 och byggde successivt upp mer och mer state-variabler och kopplade ihop dessa med \",(0,n.jsx)(e.code,{children:\"onChange()\"}),\" callbacks p\\xE5 input-f\\xE4lt och satte data fr\\xE5n API-anrop till state-variablerna.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"I takt med att vi utforskade all state-logik och komplexitet som faktiskt fanns i det formul\\xE4r vi h\\xF6ll p\\xE5 att bygga ins\\xE5g vi att det vart r\\xE4tt oh\\xE5llbart att h\\xE5lla reda p\\xE5 all state-logik. Detta f\\xF6r att sm\\xE5 bitar av formul\\xE4r-state sattes h\\xE4r och d\\xE4r i callbacks och asynkront efter API-anrop.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Vi b\\xF6rjade \\xE4ven f\\xE5 state-variabler som berodde p\\xE5 andra state-variabler och hade sv\\xE5rt att se helheten f\\xF6r formul\\xE4ret, all dess logik och nyanser av state.\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"fas-2-gruppera-state-i-ett-objekt\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#fas-2-gruppera-state-i-ett-objekt\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Fas 2: Gruppera state i ett objekt\"]}),`\n`,(0,n.jsx)(e.p,{children:\"I ett f\\xF6rs\\xF6k att ta lite mer kontroll \\xF6ver formul\\xE4rets state och f\\xE5 b\\xE4ttre \\xF6verblick s\\xE5 flyttade vi in alla individuella bitar av state till ett enda objekt ist\\xE4llet.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Att gruppera allt i ett objekt hj\\xE4lpte till avsev\\xE4rt med \\xF6verblicken av formul\\xE4r-datat. Mycket f\\xF6r att vi skrev TypeScript-kod och typade upp ett interface f\\xF6r hela formul\\xE4rets state.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Vi slapp \\xE4ven flera individuella \",(0,n.jsx)(e.code,{children:\"setState()\"}),\" anrop f\\xF6r flera sub-v\\xE4rden i state:t. Vi gick fr\\xE5n s\\xE5nt h\\xE4r:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"language-js code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"1\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token function-variable function\",children:\"onInputChange\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token parameter\",children:\"value\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"2\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"setInputOne\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"3\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" data \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"await\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fetchFromAPI\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"4\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"setDataOne\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"data\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"5\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Till att ist\\xE4llet skriva s\\xE5nt h\\xE4r:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"language-js code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"1\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token function-variable function\",children:\"onInputChange\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token parameter\",children:\"value\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"2\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" data \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"await\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"fetchFromAPI\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"3\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"setState\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token spread operator\",children:\"...\"}),\"state\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"inputOne\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"dataOne\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" data \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"4\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Perfekt. Vi hade nu allts\\xE5 b\\xE4ttre koll p\\xE5 hur formul\\xE4rets state s\\xE5g ut f\\xF6r att allt var grupperat.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"N\\xE5got vi fortfarande hade problem med var att vi i \",(0,n.jsx)(e.strong,{children:\"formul\\xE4r-komponenten beh\\xF6vde ha stenkoll p\\xE5 beroenden mellan sub-v\\xE4rden i state-objektet\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Ett konkret exempel p\\xE5 detta \\xE4r att vi allt eftersom uppt\\xE4ckte att vi beh\\xF6vde lite custom input-valideringsfeedback i formul\\xE4rets olika steg innan man kunde g\\xE5 vidare till n\\xE4sta steg. S\\xE5n feedback ritades ut i alerts direkt i formul\\xE4ret och feedback-texterna sattes i state-objektet som en array med str\\xE4ngar.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Om anv\\xE4ndaren d\\xE5 f\\xF6rs\\xF6kte g\\xE5 vidare till n\\xE4sta steg i formul\\xE4ret fick denne feedback om att viss input-data saknades. N\\xE4r anv\\xE4ndaren d\\xE5 b\\xF6rjade fylla i den datan skulle feedbacken f\\xF6rsvinna. Vi b\\xF6rjade f\\xE5 s\\xE5dana h\\xE4r exempel lite h\\xE4r och var i koden:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"language-js code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"1\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token function-variable function\",children:\"onInputChange\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token parameter\",children:\"value\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"2\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"setState\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token spread operator\",children:\"...\"}),\"state\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"inputOne\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"feedback\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"3\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Ett annat exempel p\\xE5 beroenden mellan sub-v\\xE4rden \\xE4r att det kunde uppst\\xE5 scenarion d\\xE5 anv\\xE4ndaren inte ens skulle kunna g\\xE5 vidare fr\\xE5n steg 1 till steg 2, beroende p\\xE5 den data man fick tillbaka fr\\xE5n API:et i steg 1. Detta styrde vi med boolean-flaggor i state-objektet som sattes till true eller false beroende p\\xE5 svarsdatat fr\\xE5n API:et.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Ett tredje exempel \\xE4r att all state skulle rensas n\\xE4r anv\\xE4ndarn gick tillbaka till steg 1 i formul\\xE4ret. Vi hade en generell funktion som tog in ett givet steg som en parameter och satte den parametern i state-objektet. N\\xE4r inparametern dock var \",(0,n.jsx)(e.code,{children:\"0\"}),\", vilket representerade steg 1, s\\xE5 skulle hela state:t t\\xF6mmas.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Komplexiteten och alla nyanser i state:t beh\\xF6vde dels vi som utvecklare av formul\\xE4ret, men \\xE4ven formul\\xE4ret i sig ha stenkoll p\\xE5. I en del l\\xE4gen skulle man s\\xE4tta men ocks\\xE5 rensa sub-v\\xE4rden i state:t och i andra l\\xE4gen skulle man tolka data som skulle s\\xE4ttas i tv\\xE5 sub-state v\\xE4rden p\\xE5 tv\\xE5 olika s\\xE4tt.\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"Det \\xE4r i det h\\xE4r l\\xE4get som vi b\\xF6rjade snegla p\\xE5 att anv\\xE4nda useReducer ist\\xE4llet.\"})}),`\n`,(0,n.jsxs)(e.h2,{id:\"fas-3-kasta-ut-usestate-och-v\\xE4lkomna-usereducer\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#fas-3-kasta-ut-usestate-och-v\\xE4lkomna-usereducer\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Fas 3: Kasta ut useState och v\\xE4lkomna useReducer\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Den korta beskrivningen en bit upp i denna text som beskriver de l\\xE4gen som useReducer \\xE4r att rekommendera \\xF6ver useState ang\\xE5ende komplex state-logik och sub-v\\xE4rden \\xE4r v\\xE4ldigt talande f\\xF6r de f\\xF6rdelar vi snabbt s\\xE5g efter att vi hade refaktorerat formul\\xE4rets state till en useReducer ist\\xE4llet.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Att vi b\\xF6rjade snegla mot useReducer b\\xF6rjade v\\xE4l med att vi i princip hade all state-logik p\\xE5 plats och formul\\xE4ret i sin helhet fungerade enligt kravspec, med v\\xE5rat state-objekt.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Men n\\xE4r vi kikade igenom koden k\\xE4ndes det fortfarande som att det var v\\xE4ldigt m\\xE5nga olika callbacks osv d\\xE4r state sattes och vi hade fortfarande kvar alla beroenden mellan sub-v\\xE4rden.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Formul\\xE4r-komponenten var helt enkelt sv\\xE5r att h\\xE4nga med i d\\xE5 det sattes state lite h\\xE4r och d\\xE4r och vi beh\\xF6vde ha stenkoll p\\xE5 i vilka callbacks som validerings-feedback skulle rensas osv.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Formul\\xE4ret i sig beh\\xF6vde \\xE4ven ha koll p\\xE5 att n\\xE4r anv\\xE4ndaren klickar sig bak\\xE5t mellan stegen s\\xE5 ska hela state-objektet rensas om anv\\xE4ndaren klickade sig tillbaka till f\\xF6rsta steget.\"}),`\n`,(0,n.jsxs)(e.h3,{id:\"vad-g\\xF6r-usereducer\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#vad-g\\xF6r-usereducer\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Vad g\\xF6r useReducer?\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Vad \\xE4r det d\\xE5 som skiljer useState fr\\xE5n useReducer? useReducer fungerar lite mer som Redux i det s\\xE4tt att useReducer-hooken ger tillbaka \",(0,n.jsx)(e.code,{children:\"state\"}),\" och en \",(0,n.jsx)(e.code,{children:\"dispatch\"}),\" funktion. Via dispatch skickar man olika \\u201Dactions\\u201D med eller utan data f\\xF6r att uppdatera state, via en reducer-funktion:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsx)(e.code,{className:\"language-js code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"state\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" dispatch\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"useReducer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"reducer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" initialState\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Reducer-funktionen i sin tur tar state:ta nuvarande version och en action som parametrar och vanligtvis (precis som med Redux) s\\xE5 brukar reducern best\\xE5 av en switch/case p\\xE5 \",(0,n.jsx)(e.code,{children:\"action.type\"}),\" d\\xE4r olika action-types uppdaterar state p\\xE5 lite olika s\\xE4tt.\"]}),`\n`,(0,n.jsxs)(e.blockquote,{children:[`\n`,(0,n.jsxs)(e.p,{children:[\"Vill man veta mer om useReducer s\\xE5 \\xE4r den \",(0,n.jsx)(e.a,{href:\"https://reactjs.org/docs/hooks-reference.html\",children:\"officiella dokumentationen\"}),\" en bra startpunkt.\"]}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"F\\xF6r den komponent som ska uppdatera state handlar det f\\xF6renklat om att man g\\xE5r fr\\xE5n \",(0,n.jsx)(e.code,{children:\"setState({ ...state, inputOne: value})\"}),\" till \",(0,n.jsx)(e.code,{children:\"dispatch({ type: \\u2019INPUT_ONE\\u2019, value })\"}),\".\"]}),`\n`,(0,n.jsxs)(e.h3,{id:\"vilka-f\\xF6rdelar-s\\xE5g-vi\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#vilka-f\\xF6rdelar-s\\xE5g-vi\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Vilka f\\xF6rdelar s\\xE5g vi?\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Vilka f\\xF6rdelar kunde vi d\\xE5 se n\\xE4r vi refaktorerade fr\\xE5n l\\xF6sningen med useState och v\\xE5rat state-objekt till att anv\\xE4nda useReducer ist\\xE4llet?\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Den allra st\\xF6rsta f\\xF6rdelen vi s\\xE5g var att formul\\xE4r-komponenten nu bara beh\\xF6vde fokusera p\\xE5 \",(0,n.jsx)(e.strong,{children:\"vad\"}),\" som skulle h\\xE4nda och inte exakt \",(0,n.jsx)(e.strong,{children:\"hur\"}),\" n\\xE5got skulle h\\xE4nda. Om man ska ta exemplet med att l\\xE5ta anv\\xE4ndaren backa i formul\\xE4ret s\\xE5 gick vi fr\\xE5n (ungef\\xE4r):\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"language-js code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"1\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token function-variable function\",children:\"onStepChange\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token parameter\",children:\"step\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"2\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"step \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"===\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"3\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"setState\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"emptyFormData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"4\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"5\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"6\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"setState\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token spread operator\",children:\"...\"}),\"state\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"step\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" step \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"7\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Till en l\\xF6sning d\\xE4r formul\\xE4ret inte beh\\xF6vde bry sig om s\\xE5dana detaljer:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"language-js code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"1\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token function-variable function\",children:\"onStepChange\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token parameter\",children:\"step\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"2\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token function\",children:\"dispatch\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \\u2019\",(0,n.jsx)(e.span,{className:\"token constant\",children:\"FORM_STEP\"}),\"\\u2019\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"step\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" step \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line line-number\",line:\"3\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"V\\xE5r formul\\xE4r-reducer s\\xE5g d\\xE5 till att sj\\xE4lv antingen bara backa ett steg eller rensa hela formul\\xE4ret i sin helhet, d\\xE5 anv\\xE4ndaren backade till f\\xF6rsta steget.\"}),`\n`,(0,n.jsx)(e.p,{children:\"En annan f\\xF6rdel vi s\\xE5g var att formul\\xE4ret inte l\\xE4ngre beh\\xF6vde bry sig om att i vissa l\\xE4gen rensa den validerings-feedback array som fanns i state. S\\xE5dana detaljer var upp till reducern att sk\\xF6ta, beroende p\\xE5 vilken action som formul\\xE4ret dispatchade.\"}),`\n`,(0,n.jsx)(e.p,{children:\"En tredje f\\xF6rdel var att formul\\xE4ret nu inte l\\xE4ngre beh\\xF6vde bry sig alls om eventuella beroenden mellan sub-v\\xE4rden i state:t. Formul\\xE4ret dispatchade bara sina actions med tillh\\xF6rande data och reducern s\\xE5g till att s\\xE4tta eventuella boolean-flaggor osv sj\\xE4lv.\"}),`\n`,(0,n.jsxs)(e.h3,{id:\"mer-boilerplate-kod-men-kontrollerade-state-f\\xF6r\\xE4ndringar\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#mer-boilerplate-kod-men-kontrollerade-state-f\\xF6r\\xE4ndringar\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Mer boilerplate-kod men kontrollerade state-f\\xF6r\\xE4ndringar\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Visserligen innebar useReducern lite mer \\u201Dboilerplate-kod\\u201D, framf\\xF6r allt d\\xE5 vi jobbar med TypeScript och typade upp alla action-typen och payloads som man kunde skicka in i reducern. Men detta innebar ju ocks\\xE5 att vi fick ett tydligare kontrakt mellan formul\\xE4ret och reducern, och hur formul\\xE4ret kunde p\\xE5verka state:t p\\xE5 ett v\\xE4ligt kontrollerat s\\xE4tt.\"}),`\n`,(0,n.jsx)(e.p,{children:\"All boilerplate gjorde det tydligt att vi kunde lyfta ut useReducern till en custom hook. D\\xE5 vi gjorde detta blev dessutom formul\\xE4r-komponenten 100% mer \\xF6versk\\xE5dlig. Nu ansvarade formul\\xE4r-komponenten i princip bara f\\xF6r att h\\xE4mta data fr\\xE5n API:er i vissa funktioner och dispatcha actions, samt dispatcha vissa actions direkt i \\u201DonInputChange-funktioner\\u201D.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"All faktiskt state-hantering lyftes ut till en separat fil. Beh\\xF6vde vi se hur state:t s\\xE5g ut eller hur det skulle f\\xF6r\\xE4ndras \\xF6ver tid gav reducern oss en tydligare \\xF6verblick, ist\\xE4llet f\\xF6r att beh\\xF6va skrolla runt i formul\\xE4r-komponenten och jaga \",(0,n.jsx)(e.code,{children:\"setState\"}),\" anrop.\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"summering\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#summering\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Summering\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Phew! D\\xE4r var vi i m\\xE5l!\"}),`\n`,(0,n.jsx)(e.p,{children:\"Vad kan man d\\xE5 dra f\\xF6r summerande slutsatser av det hela? Ska man strunta i useState helt och ist\\xE4llet anv\\xE4nda useReducer? Absolut inte! Hook:en useState \\xE4r v\\xE4ldigt bra om man har ett state som inte \\xE4r speciellt komplext. Att alltid anv\\xE4nda useReducer skulle f\\xF6rmodligen inneb\\xE4ra on\\xF6digt komplex l\\xF6sning f\\xF6r en icke-komplex utmaning.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Men \\xE5 andra sidan tror jag inte man ska vara r\\xE4dd f\\xF6r att byta ut useState mot useReducer i de l\\xE4gen en komponents state v\\xE4xer. Personligen tyckte jag att useReducer s\\xE5g ut som on\\xF6digt avancerat s\\xE4tt att hantera state i funktions-komponenter innan jag testade p\\xE5 den, men s\\xE5g genast f\\xF6rdelar med den n\\xE4r jag v\\xE4l b\\xF6rjade anv\\xE4nda den.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Har man lite mer avancerat state och synkar inte bara input-f\\xE4lt till data eller t\\xE4nder och sl\\xE4cker grejer rent visuellt med boolean-flaggor \\xE4r useReducer ett v\\xE4ldigt bra alternativ f\\xF6r att f\\xE5 b\\xE4ttre kontroll \\xF6ver state och state-f\\xF6r\\xE4ndringar.\"}),`\n`,(0,n.jsxs)(e.blockquote,{children:[`\n`,(0,n.jsxs)(e.p,{children:[\"V\\xE4rt att p\\xE5peka \\xE4r ju att det h\\xE4r \\xE4r tankar och funderingar efter att ha anv\\xE4nt useReducer \",(0,n.jsx)(e.em,{children:\"en\"}),\" g\\xE5ng. Men jag k\\xE4nde \\xE4nd\\xE5 f\\xF6r att f\\xE5 nedskrivet n\\xE5gra reflektioner.\"]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"N\\xE4sta g\\xE5ng jag st\\xE5r inf\\xF6r lite mer avancerad state kommer jag i alla fall inte tveka att \\xF6verv\\xE4ga useReducer som l\\xF6sning ist\\xE4llet f\\xF6r useState, d\\xE5 man har mycket att vinna p\\xE5 det!\"})]})}function y(a={}){let{wrapper:e}=a.components||{};return e?(0,n.jsx)(e,Object.assign({},a,{children:(0,n.jsx)(d,a)})):d(a)}var j=y;return N(S);})();\n;return Component;"},"_id":"posts/nar-man-formodligen-vill-byta-ut-use-state-mot-use-reducer.mdx","_raw":{"sourceFilePath":"posts/nar-man-formodligen-vill-byta-ut-use-state-mot-use-reducer.mdx","sourceFileName":"nar-man-formodligen-vill-byta-ut-use-state-mot-use-reducer.mdx","sourceFileDir":"posts","contentType":"mdx","flattenedPath":"posts/nar-man-formodligen-vill-byta-ut-use-state-mot-use-reducer"},"type":"Post","url":"/blogg/nar-man-formodligen-vill-byta-ut-use-state-mot-use-reducer","dateFormatted":"2021-02-13"},"nextPost":null},"__N_SSG":true}